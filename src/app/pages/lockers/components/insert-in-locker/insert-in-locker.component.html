<h3>
    <strong>
        {{ params.order_service ? 'Ingreso a Casillero #'+ params.order_service : 'Ingreso a Casillero' }}
    </strong>
</h3>

<h4>
    {{ locker.full_info }}
</h4>

<br>

<div class="container-fluid" *ngIf="formInsertLocker">

    <form [formGroup]="formInsertLocker">

        <div class="container-fluid">

            <div class="row">

                <div class="col-sm">

                    <div class="form-group">

                        <label for="guia">Guia Origen</label>

                        <input type="text" id="guia" class="form-control" placeholder="Busca el número de guía"
                            formControlName="guide_number" [matAutocomplete]="auto_guide"
                            (input)="autoCompleteGuide($event.target.value);"
                            title="{{ formInsertLocker.controls.guide_number.value ? formInsertLocker.controls.guide_number.value : '' }}"
                            [ngClass]="{ 'is-invalid' : form.guide_number.errors }">
                        <div class="invalid-feedback" *ngIf="form.guide_number.errors">
                            <ng-container *ngIf="form.guide_number.errors.required">
                                Debes ingresar una guia de origen.
                            </ng-container>
                        </div>
                        <mat-autocomplete #auto_guide="matAutocomplete" [displayWith]="displayGuides">
                            <mat-option *ngFor="let guide of allGuides" [value]="guide"
                                (click)="clickGuideItem(guide);">
                                {{ guide.guide_number_alph ? guide.guide_number_alph : guide.guide_number }}
                            </mat-option>
                        </mat-autocomplete>

                    </div>

                </div>

                <div class="col-sm">
                    <div class="form-group">
                        <label for="name">Nombre o Casillero de Cliente</label>
                        <input type="text" class="form-control" id="name"
                            placeholder="Ingresa el nombre o casillero del cliente" formControlName="user"
                            [ngClass]="{ 'is-invalid' : form.user.errors }" [matAutocomplete]="auto_user">
                        <div class="invalid-feedback" *ngIf="form.user.errors">
                            <ng-container *ngIf="form.user.errors.required">
                                Debes seleccionar un casillero.
                            </ng-container>
                        </div>
                        <mat-autocomplete #auto_user="matAutocomplete" [displayWith]="displayLocker">
                            <mat-option *ngFor="let user of filteredUsers | async" [value]="user"
                                title="CA{{ user.locker_id }} {{ user.name }} {{ user.last_name }}">
                                CA{{ user.locker_id }} {{ user.name }} {{ user.last_name }}
                            </mat-option>
                        </mat-autocomplete>
                    </div>
                </div>

                <div class="col-sm">
                    <div class="form-group">
                        <label for="name">Orden de Servicio</label>
                        <input type="text" class="form-control" id="name" placeholder="Busca la orden de servicio..."
                            formControlName="order_service" [ngClass]="{ 'is-invalid' : form.order_service.errors }"
                            [matAutocomplete]="auto_order_service">
                        <div class="invalid-feedback" *ngIf="form.order_service.errors">
                            <ng-container *ngIf="form.order_service.errors.required">
                                Debes seleccionar un casillero.
                            </ng-container>
                        </div>
                        <mat-autocomplete #auto_order_service="matAutocomplete" [displayWith]="displayOrder">
                            <mat-option *ngFor="let order of filteredOrders | async" [value]="order"
                                title="{{ order.order_service?.id ? order.order_service?.id : '' }} | {{ order.product.name ? order.product.name : '' }}"
                                (click)="clickOrderItem(order);">
                                {{ order.order_service?.id ? order.order_service?.id : '' }} |
                                {{ order.product.name ? order.product.name : '' }}
                            </mat-option>
                        </mat-autocomplete>
                    </div>
                </div>

                <div class="col-sm">
                    <div class="form-group">
                        <label for="conveyor">Transportadora</label>
                        <input type="email" class="form-control" id="conveyor"
                            placeholder="Selecciona una transportadora." formControlName="conveyor"
                            [ngClass]="{ 'is-invalid' : form.conveyor.errors }" [matAutocomplete]="auto_conveyors">
                        <div class="invalid-feedback" *ngIf="form.conveyor.errors">
                            <ng-container *ngIf="form.conveyor.errors.required">
                                Debes seleccionar la transportadora.
                            </ng-container>
                        </div>
                        <mat-autocomplete #auto_conveyors="matAutocomplete" [displayWith]="displayFn">
                            <mat-option *ngFor="let conveyor of filteredConveyors | async" [value]="conveyor">
                                {{ conveyor.name }}
                            </mat-option>
                        </mat-autocomplete>
                    </div>
                </div>

                <div class="col-sm">
                    <div class="form-group">
                        <label for="dateLocker">Fecha de Ingreso</label>
                        <div class="input-group clockpicker">
                            <input ngbDatepicker class="form-control" id="dateLocker" placeholder="yyyy-mm-dd"
                                #dl="ngbDatepicker" formControlName="receipt_date"
                                [ngClass]="{ 'is-invalid' : form.receipt_date.errors }">
                            <div class="input-group-append" (click)="dl.toggle()">
                                <span class="input-group-text"><i class="mdi mdi-calendar"></i></span>
                            </div>
                            <div class="invalid-feedback" *ngIf="form.receipt_date.errors">
                                <ng-container *ngIf="form.receipt_date.errors.required">
                                    Debes ingresar una fecha de recibido.
                                </ng-container>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <br>
            <!-- 
            <button class="button-encargomio" type="submit" [disabled]="formInsertLocker.invalid"
                *ngIf="!products || products.value.length === 0">
                Iniciar Ingreso
            </button> -->

        </div>

        <app-not-income-products [order_has_products]="order_has_products" [formInsertLocker]="formInsertLocker"
            [order_service]="params.order_service">
        </app-not-income-products>

        <app-income-products [locker_has_product]="locker_has_product" [formInsertLocker]="formInsertLocker"
            [order_service]="params.order_service">
        </app-income-products>

    </form>

</div>